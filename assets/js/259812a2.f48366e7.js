"use strict";(self.webpackChunklunat_1_c=self.webpackChunklunat_1_c||[]).push([[9918],{3719:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var l=r(5893),t=r(1151);const o={title:"",sidebar_label:"Collections"},s=void 0,a={id:"records/vba/VBA",title:"",description:"No.1 \u9009\u53d6\u6587\u4ef6\u5939",source:"@site/docs/records/vba/VBA.md",sourceDirName:"records/vba",slug:"/records/vba/",permalink:"/lunat1c/docs/records/vba/",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/records/vba/VBA.md",tags:[],version:"current",frontMatter:{title:"",sidebar_label:"Collections"},sidebar:"records",previous:{title:"VBA",permalink:"/lunat1c/docs/category/vba"},next:{title:"KqlQuery",permalink:"/lunat1c/docs/category/kqlquery"}},i={},d=[{value:"No.1 \u9009\u53d6\u6587\u4ef6\u5939",id:"no1-\u9009\u53d6\u6587\u4ef6\u5939",level:3},{value:"No.2 \u4f9d\u6b21\u8bfb\u53d6\u6587\u4ef6\uff08\u4e0d\u5305\u542bSubFolder\uff09",id:"no2-\u4f9d\u6b21\u8bfb\u53d6\u6587\u4ef6\u4e0d\u5305\u542bsubfolder",level:3},{value:"No.3 \u4f9d\u6b21\u8bfb\u53d6\u6587\u4ef6\uff08\u5305\u542bSubFolder\uff09",id:"no3-\u4f9d\u6b21\u8bfb\u53d6\u6587\u4ef6\u5305\u542bsubfolder",level:3},{value:"No.4 \u53d6\u6700\u7ec8\u884c",id:"no4-\u53d6\u6700\u7ec8\u884c",level:3},{value:"No.5 \u53d6\u6700\u7ec8\u5217",id:"no5-\u53d6\u6700\u7ec8\u5217",level:3},{value:"No.6 \u590d\u5236\u7c98\u8d34\u5e26\u516c\u5f0f\u7684\u5355\u5143\u683c",id:"no6-\u590d\u5236\u7c98\u8d34\u5e26\u516c\u5f0f\u7684\u5355\u5143\u683c",level:3},{value:"No.7 \u591a\u4e2a\u8fde\u7eed\u5355\u5143\u683c\u65f6\uff0c\u83b7\u53d6\u6700\u7ec8\u5217",id:"no7-\u591a\u4e2a\u8fde\u7eed\u5355\u5143\u683c\u65f6\u83b7\u53d6\u6700\u7ec8\u5217",level:3},{value:"No.8 \u67e5\u627e\u6307\u5b9a\u5185\u5bb9\u7684\u4f4d\u7f6e",id:"no8-\u67e5\u627e\u6307\u5b9a\u5185\u5bb9\u7684\u4f4d\u7f6e",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h3:"h3",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h3,{id:"no1-\u9009\u53d6\u6587\u4ef6\u5939",children:"No.1 \u9009\u53d6\u6587\u4ef6\u5939"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["\ud83d\udd5a","\u5728\u9700\u8981\u5faa\u73af\u8bfb\u53d6\u6307\u5b9a\u6587\u4ef6\u5939\u4e2d\u591a\u4e2a\u6587\u4ef6\u65f6\uff0c\u63d0\u4f9b\u9009\u62e9\u6587\u4ef6\u5939\u7684\u5f39\u7a97\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-vba",children:'Sub GetFolderPath()\r\n\r\n    \' FolderPath\r\n    Dim folderPath As String\r\n\r\n    \' \u8c03\u7528\u65b9\u6cd5\r\n    With Application.FileDialog(msoFileDialogFolderPicker)\r\n        \' \u5f39\u7a97\u540d\u79f0\r\n        .Title = "choose folder"\r\n\r\n        \' \u6309\u4e0bOK .Show = -1;\r\n        \' \u6309\u4e0bCancel .Show = 0;\r\n\r\n        If .Show = -1 Then\r\n            folderPath = .SelectedItems(1)\r\n\r\n            \' \u8d4b\u503c\u7ed9\u4f60\u60f3\u8981\u7684\u4f4d\u7f6e\r\n            \' ThisWorkbook.Worksheets("Sheet1").Range("D3").value = folderPath\r\n            ActiveSheet.Range("D3").value = folderPath\r\n            \' Range("D3").value = folderPath\r\n\r\n        End If\r\n    End With\r\n\r\nEnd Sub\n'})}),"\n",(0,l.jsx)(n.h3,{id:"no2-\u4f9d\u6b21\u8bfb\u53d6\u6587\u4ef6\u4e0d\u5305\u542bsubfolder",children:"No.2 \u4f9d\u6b21\u8bfb\u53d6\u6587\u4ef6\uff08\u4e0d\u5305\u542bSubFolder\uff09"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["\ud83d\udd5a","\u5faa\u73af\u8bfb\u53d6\u6307\u5b9a\u6587\u4ef6\u5939\u4e2d\u591a\u4e2a\u6587\u4ef6\uff08\u53ef\u4ee5\u6307\u5b9a\u6587\u4ef6\u540e\u7f00\u540d\uff09\uff0c\u7136\u540e\u6dfb\u52a0\u4f60\u60f3\u8981\u5bf9\u6587\u4ef6\u8fdb\u884c\u7684\u64cd\u4f5c\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:["\ud83d\udca1","\u53ef\u4ee5\u6539\u5199\u4e3a\u5e26\u53c2\u6570\u7c7b\u578b"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-vba",children:"Sub ReadFilesInFolder()\r\n    Dim folderPath As String\r\n    Dim fileExtension As String\r\n    Dim fileName As String\r\n    Dim fileContent As String\r\n\r\n    ' \u8fd9\u91cc\u7528\u7684\u662f\u4e0a\u9762\u7684D3\u7684value\uff0c\u53ef\u4ee5\u81ea\u884c\u8d4b\u503c\r\n    folderPath = Range(\"D3\").value\r\n    ' \u6307\u5b9a\u60f3\u8981\u8bfb\u53d6\u7684\u6587\u4ef6\u540e\u7f00\r\n    fileExtension = \"txt\"\r\n\r\n    ' \u4f7f\u7528 Dir \u51fd\u6570\u5217\u51fa\u6587\u4ef6\u5939\u4e2d\u6240\u6709\u5177\u6709\u6307\u5b9a\u540e\u7f00\u7684\u6587\u4ef6\r\n    ' \u5c06\u7b2c\u4e00\u4e2a\u6587\u4ef6\u540d\u8d4b\u503c\u7ed9 fileName \u53d8\u91cf\r\n    fileName = Dir(folderPath & \"\\\\*.\" & fileExtension)\r\n    ' \u5faa\u73af\u6240\u6709\u6587\u4ef6\r\n    Do While fileName <> \"\"\r\n        ' \u6253\u5f00\u6587\u4ef6\u4e3a#1\u7528\u4e8e\u8f93\u5165\r\n        Open folderPath & \"\\\\\" & fileName For Input As #1\r\n\r\n        ' Input$ \u51fd\u6570\u7528\u4e8e\u4ece\u6253\u5f00\u7684\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6307\u5b9a\u957f\u5ea6\u7684\u6587\u672c\r\n        ' LOF(1) \u6307\u5b9a\u4e86\u8981\u8bfb\u53d6\u7684\u957f\u5ea6\uff0c#1 \u6307\u5b9a\u4e86\u6587\u4ef6\u53f7\r\n        ' \u5176\u4e2dLOF(1) \u51fd\u6570\u8fd4\u56de\u6253\u5f00\u6587\u4ef6\u7684\u957f\u5ea6\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09\r\n        ' \u5c06\u6253\u5f00\u7684\u6587\u4ef6\u7684\u5168\u90e8\u5185\u5bb9\u8bfb\u53d6\r\n        fileContent = Input$(LOF(1), #1)\r\n\r\n        ' \u5173\u95ed\u6587\u4ef6\r\n        Close #1\r\n\r\n        ' \u8d4b\u503c\u7ed9cell\uff08\u53ef\u81ea\u884c\u66f4\u6539\uff09\r\n        Range(\"B\" & Cells(Rows.Count, 2).End(xlUp).row + 1).value = fileContent\r\n        ' \u83b7\u53d6\u4e0b\u4e00\u4e2a\u6587\u4ef6\u540d\uff0c\u7ee7\u7eed\u5faa\u73af\r\n        fileName = Dir\r\n    Loop\r\nEnd Sub\n"})}),"\n",(0,l.jsx)(n.h3,{id:"no3-\u4f9d\u6b21\u8bfb\u53d6\u6587\u4ef6\u5305\u542bsubfolder",children:"No.3 \u4f9d\u6b21\u8bfb\u53d6\u6587\u4ef6\uff08\u5305\u542bSubFolder\uff09"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["\ud83d\udd5a","\u5faa\u73af\u8bfb\u53d6\u6307\u5b9a\u6587\u4ef6\u5939\u4e2d\u591a\u4e2a\u6587\u4ef6\uff08\u53ef\u4ee5\u6307\u5b9a\u6587\u4ef6\u540e\u7f00\u540d\uff09\uff0c\u7136\u540e\u6dfb\u52a0\u4f60\u60f3\u8981\u5bf9\u6587\u4ef6\u8fdb\u884c\u7684\u64cd\u4f5c\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:["FSO\u8fd8\u6709\u5f88\u591a\u65b9\u6cd5\u53ef\u4ee5\u64cd\u4f5c\u78c1\u76d8\u3001\u6587\u4ef6\u5939\u3001\u6587\u4ef6\u7b49\uff0c\u8be6\u89c1","\ud83d\udc49",(0,l.jsx)(n.a,{href:"https://learn.microsoft.com/zh-tw/office/vba/language/reference/user-interface-help/filesystemobject-object",title:"go",children:"FSO"})]}),"\n",(0,l.jsxs)(n.p,{children:["\ud83d\ude45\u200d\u2642\ufe0f",'\u4f46\u662fFSO\u65e0\u6cd5\u64cd\u4f5c\u4e8c\u8fdb\u5236\u6587\u4ef6\uff1b\u5982\u9700\u8981\uff0c\u8bf7\u4f7f\u7528CreateObject("ADODB.Stream")']}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-vba",children:'Set objStream = CreateObject("ADODB.Stream")\r\n    objStream.Charset = "utf-8"\r\n    objStream.Open\r\n    objStream.LoadFromFile (FilePath)\r\n    strData = objStream.ReadText()\n'})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-vba",children:"Sub ReadFilesInFolder(folderPath)\r\n    Dim fso As Object\r\n    Dim folder As Object\r\n    Dim subfolder As Object\r\n    Dim file As Object\r\n    Dim fileExtension As String    \r\n\r\n    Set fso = CreateObject(\"Scripting.FileSystemObject\")\r\n    ' \u5229\u7528fso\u7684GetFolder\u65b9\u6cd5\u8bfb\u53d6\u6587\u4ef6\u5939\u4e2d\u7684\u5185\u5bb9\r\n    Set folder = fso.GetFolder(folderPath)\r\n    ' \u6307\u5b9a\u60f3\u8981\u8bfb\u53d6\u7684\u6587\u4ef6\u540e\u7f00\r\n    fileExtension = \"txt\"\r\n\r\n    ' \u5faa\u73af\u904d\u5386\u6587\u4ef6\u5939\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\r\n    For Each file In folder.Files\r\n        ' \u68c0\u67e5\u6587\u4ef6\u662f\u5426\u5177\u6709\u6307\u5b9a\u7684\u6587\u4ef6\u540e\u7f00\r\n        If fso.GetExtensionName(file.Path) = fileExtension Then\r\n            ' \u6309\u9700\u5904\u7406\u6587\u4ef6\r\n            ' ...\r\n        End If\r\n    Next file\r\n\r\n    ' \u5faa\u73af\u904d\u5386\u6587\u4ef6\u5939\u4e2d\u7684\u6bcf\u4e2a\u5b50\u6587\u4ef6\u5939\r\n    For Each subfolder In folder.Subfolders\r\n        ' \u5bf9\u6bcf\u4e2a\u5b50\u6587\u4ef6\u5939\u9012\u5f52\u8c03\u7528\u76f8\u540c\u7684\u5faa\u73af\r\n        ReadFilesInFolder(subfolder)\r\n    Next subfolder\r\nEnd Sub\n"})}),"\n",(0,l.jsx)(n.h3,{id:"no4-\u53d6\u6700\u7ec8\u884c",children:"No.4 \u53d6\u6700\u7ec8\u884c"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["\ud83d\udd5a","\u62ff\u5230sheet\u4e2d\u8fd8\u672a\u7f16\u8f91\u7684\u6700\u540e\u4e00\u884c"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-vba",children:"    Dim LastRow As Integer\r\n    ' \u5982\u679c\u60f3\u8981\u4ece\u522b\u7684\u5217\u8fdb\u884c\u5224\u65ad\uff0c\u8bf7\u66f4\u6539K\u4e3a\u4f60\u60f3\u8981\u7684\u5217\r\n    LastRow = Range(\"K\" & Rows.Count).End(xlUp).row + 1\r\n    ' \u540c\u6837\u7684\u6548\u679c\r\n    LastRow = [K65536].End(xlUp).row + 1\r\n    ' or\uff08\u8bf7\u81ea\u884c\u4fee\u6539\u5217\u6570\uff09\r\n    LastRow = Cells(Rows.Count, 2).End(xlUp).Row\r\n\r\n    MsgBox (LastRow)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"no5-\u53d6\u6700\u7ec8\u5217",children:"No.5 \u53d6\u6700\u7ec8\u5217"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["\ud83d\udd5a","\u62ff\u5230sheet\u4e2d\u8fd8\u672a\u7f16\u8f91\u7684\u6700\u540e\u4e00\u5217"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-vba",children:"    ' \u7b2c\u4e09\u884c\u7684\u975e\u7a7a\u5355\u5143\u683c\u7684\u6700\u7ec8\u5217\u6570\r\n    lastColumn = Cells(3, Columns.Count).End(xlToLeft).Column\r\n    ' \u4f46\u662f\u4e0a\u9762\u7684\u4e0d\u9002\u7528\u4e8e\u5408\u5e76\u5355\u5143\u683c\u7684\u60c5\u51b5\uff0c\u53ea\u80fd\u83b7\u53d6\u5230\u5408\u5e76\u5355\u5143\u683c\u7684\u9996\u5217\r\n\r\n    ' \u5224\u65ad\u7b2c\u4e09\u884c\u7684\u8fd9\u4e00\u5217\u7684\u8fd9\u4e2a\u5355\u5143\u683c\u662f\u5426\u662f\u5408\u5e76\u5355\u5143\u683c\r\n    If Cells(3, lastColumn).MergeCells Then\r\n        ' \u62ff\u5230\u5408\u5e76\u5355\u5143\u683c\u7684\u6700\u53f3\u8fb9\u4e00\u5217\u7684\u5217\u6570\r\n        mergedLastColumn = Cells(3, lastColumn).MergeArea.Columns.Count + lastColumn - 1\r\n    End If\r\n    ' \u6b64\u65f6\u62ff\u5230\u7684\u624d\u662f\u6700\u7ec8\u5217\u6570\n"})}),"\n",(0,l.jsx)(n.h3,{id:"no6-\u590d\u5236\u7c98\u8d34\u5e26\u516c\u5f0f\u7684\u5355\u5143\u683c",children:"No.6 \u590d\u5236\u7c98\u8d34\u5e26\u516c\u5f0f\u7684\u5355\u5143\u683c"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["\ud83d\udd5a","\u5982\u679c\u4e0d\u60f3\u7c98\u8d34\u516c\u5f0f\u800c\u662f\u53ea\u7c98\u8d34\u503c\u7684\u8bdd"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-vba",children:'    \' \u9009\u62e9\u533a\u57df\r\n    Range("J2:J10").Select\r\n    \' copy\u533a\u57df\r\n    Selection.Copy\r\n    \' \u7279\u6b8a\u7c98\u8d34\uff08\u4e0d\u4f1a\u5c06\u5f15\u7528\u590d\u5236\u8fc7\u6765\uff09\r\n    Range("K2").PasteSpecial Paste:=xlPasteValues\r\n    \' \u7279\u6b8a\u7c98\u8d34\uff08\u4fdd\u7559\u539f\u6765\u7684\u6837\u5f0f\uff09\r\n    Range("K2").PasteSpecial Paste:=xlPasteFormats\n'})}),"\n",(0,l.jsx)(n.h3,{id:"no7-\u591a\u4e2a\u8fde\u7eed\u5355\u5143\u683c\u65f6\u83b7\u53d6\u6700\u7ec8\u5217",children:"No.7 \u591a\u4e2a\u8fde\u7eed\u5355\u5143\u683c\u65f6\uff0c\u83b7\u53d6\u6700\u7ec8\u5217"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-vba",children:"Function GetNextMergedCell(startRange As Range) As Integer\r\n\r\n\r\n    Dim currentRange As Range\r\n    Dim EndColumn As Integer\r\n    Set currentRange = startRange\r\n\r\n    ' \u5982\u679c\u5f53\u524drange\u6216\u8005cell\u662f\u5408\u5e76\u5355\u5143\u683c\r\n    If currentRange.MergeCells Then\r\n        ' \u8d4b\u503c\u5408\u5e76\u5355\u5143\u683c\r\n        Dim mergeRange As Range\r\n        Set mergeRange = currentRange.MergeArea\r\n        ' \u5f00\u59cb\u5faa\u73af\uff0c\u76f4\u5230\u79fb\u52a8\u5230\u975e\u5408\u5e76\u5355\u5143\u683c\u4e3a\u6b62\r\n        Do While mergeRange.MergeCells\r\n            ' \u79fb\u52a8\u5230\u4e0b\u4e00\u4e2a\u5408\u5e76\u5355\u5143\u683c\r\n            Set currentRange = mergeRange.Cells(1, mergeRange.Columns.Count + 1)\r\n            Set mergeRange = currentRange.MergeArea\r\n        Loop\r\n    End If\r\n\r\n    ' \u7531\u4e8e\u6700\u7ec8\u662f\u5728\u975e\u5408\u5e76\u5355\u5143\u683c\u9000\u51fa\u5faa\u73af\u7684\uff0c\u9700\u8981\u51cf\u4e00\r\n    EndColumn = currentRange.Column\r\n    GetNextMergedCell = EndColumn - 1\r\n\r\nEnd Function\n"})}),"\n",(0,l.jsx)(n.h3,{id:"no8-\u67e5\u627e\u6307\u5b9a\u5185\u5bb9\u7684\u4f4d\u7f6e",children:"No.8 \u67e5\u627e\u6307\u5b9a\u5185\u5bb9\u7684\u4f4d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-vba",children:'Sub FindStr()\r\n    Dim str As String\r\n    Dim rng As Range\r\n    Dim target As Range\r\n    str = "111"\r\n    Set rng = ActiveSheet.Cells\r\n    Set target = rng.Find(str)\r\n    \r\n    If Not target Is Nothing Then\r\n        MsgBox target.Address\r\n    Else\r\n        MsgBox "notfind"\r\n    End If\r\nEnd Sub\n'})})]})}function u(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>s});var l=r(7294);const t={},o=l.createContext(t);function s(e){const n=l.useContext(o);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);